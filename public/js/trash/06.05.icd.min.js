function getJsonFile(e){var t=new XMLHttpRequest;return t.open("POST","json/"+e+".json",!1),t.onreadystatechange=function(){4===t.readyState&&(200===t.status||0==t.status)&&(allText=t.responseText)},t.send(null),JSON.parse(allText)}function slideCatalog(e){screen.width>690?$("#catalog").animate({left:-width1*e}):$("#catalog").css("left",-width1*e)}function formCatalog(e,t,l,o){switch(console.log("formCatalog"),catalog=this.find("ul"),catalog.empty(),t){case"disease":for(n in e)li=$("<li>"+e[n].l+"."+e[n].n1+"."+e[n].n2+" "+e[n].label+"</li>"),li.attr({"class":"element list-group-item",element:t,l:e[n].l,n1:e[n].n1,n2:e[n].n2,number:n}),catalog.append(li);break;case"nosology":for(n in e)count=14,li=$('<li> <span class="badge pull-right">'+count+"</span>"+e[n].l+"."+e[n].n1+" "+e[n].label+"</li>"),li.attr({"class":"element list-group-item",element:t,l:e[n].l,n1:e[n].n1,number:n}),catalog.append(li);break;default:for(n in e)count=10,li=$('<li> <span class="badge pull-right">'+count+"</span>["+e[n].l1+"."+e[n].n1+"-"+e[n].l2+"."+e[n].n2+"] "+e[n].label+"</li>"),li.attr({"class":"element list-group-item",element:t,l1:e[n].l1,n1:e[n].n1,l2:e[n].l2,n2:e[n].n2,number:n}),catalog.append(li)}}function alphabet(){for(var e=this,t=65;91>t;t++)letter=String.fromCharCode(t),op=document.createElement("option"),op.setAttribute("value",letter),op.innerHTML=letter,e.append(op)}function searchBySelect(e){var t;if(letter=$("#letter").val(),number1=$("#number1a").val()+""+$("#number1b").val(),"nosologies"==e){nos=ICD.nosologies;for(i in ICD.nosologies)ICD.nosologies[i].l==letter&&ICD.nosologies[i].n1==number1&&(t=ICD.nosologies[i].l+"."+ICD.nosologies[i].n1+". "+ICD.nosologies[i].label)}else{number2=$("#number2").val(),dis=ICD.diseases;for(i in dis)dis[i].l==letter&&dis[i].n1==number1&&dis[i].n2==number2&&(t=dis[i].l+"."+dis[i].n1+"."+dis[i].n2+". "+dis[i].label)}$("#select_result").text(t)}function selectValidate(){"-"==$("#letter").val()?$("#select_result").text("Choose Letter"):"-"==$("#number1a").val()||"-"==$("#number1b").val()?$("#select_result").text("Choose N1 first and second numbers"):searchBySelect("-"==$("#number2").val()?"nosologies":"diseases")}function Width1(){width1=$("#catalog-wrapper").width(),$(".list").width(width1-2),console.log("w1",width1)}function Width2(){width2=$("#autocomplete").outerWidth(),console.log("w2",width2)}var byID=function(e){return document.getElementById(e)},ICD={number:10,classes:[],blocks:[],diagnoses:[],diseases:[]},_count={count:ICD.classes.length,"class":[],block:[[]],nosology:[]},classes=[],blocks=[],diseases=[],nosologies=[],width1,width2,stepCatalog=0;jQuery.fn.extend({}),$(window).resize(function(){Width1(),slideCatalog(stepCatalog),Width2()}),$("select.numbers").each(function(){for(var e=0;10>e;e++){var t=document.createElement("option");t.setAttribute("value",e),t.innerHTML=e,this.appendChild(t)}}),$("#selectSearchSubmit").click(function(){selectValidate()}),$(".selDisNum").change(function(){numbers=[],letter=$("#letter").val(),number1=$("#number1a").val()+""+$("#number1b").val(),dis=ICD.diseases;for(i in dis)dis[i].l==letter&&dis[i].n1==number1&&numbers.push(ICD.diseases[i].n2);el=$("#number2"),el.find("option").remove(),op=document.createElement("option"),op.setAttribute("value","-"),op.innerHTML="-",el.append(op);for(i in numbers)op=document.createElement("option"),op.setAttribute("value",numbers[i]),op.innerHTML=numbers[i],el.append(op)}),$(".icd_select").change(function(){select_code=$("#letter").val()+"."+$("#number1a").val()+$("#number1b").val()+"."+$("#number2").val(),$("#select_code").text(select_code)}),$("body").on("click","#catalog-wrapper .backCatalog",function(){stepCatalog--,slideCatalog(stepCatalog)}),$("body").on("click","#catalog-wrapper li.element",function(){if(element=$(this).attr("element"),ind=$(this).attr("number"),newElements=[],"class"==element||"block"==element)if(l1=$(this).attr("l1"),code1=l1.charCodeAt(0),n1=$(this).attr("n1"),l2=$(this).attr("l2"),code2=l2.charCodeAt(0),n2=$(this).attr("n2"),"class"==element){for(n in ICD.blocks)char1=ICD.blocks[n].l1.charCodeAt(0),char2=ICD.blocks[n].l2.charCodeAt(0),(char1>=code1&&char2<code2||char1>=code1&&char2<=code2&&ICD.blocks[n].n1>=n1&&ICD.blocks[n].n1<=n2&&ICD.blocks[n].n2>=n1&&ICD.blocks[n].n2<=n2)&&newElements.push(ICD.blocks[n]);formCatalog.call($("#catalog2"),newElements,"block",ind)}else{for(n in ICD.nosologies)char0=ICD.nosologies[n].l.charCodeAt(0),char0>=code1&&char0<=code2&&ICD.nosologies[n].n1>=n1&&ICD.nosologies[n].n1<=n2&&newElements.push(ICD.nosologies[n]);formCatalog.call($("#catalog3"),newElements,"nosology",ind)}else{if("nosology"!=element)return;l=$(this).attr("l"),n1=$(this).attr("n1");for(n in ICD.diseases)ICD.diseases[n].l==l&&ICD.diseases[n].n1==n1&&newElements.push(ICD.diseases[n]);formCatalog.call($("#catalog4"),newElements,"disease",ind)}newElements.length=0,height=$(".navbar-fixed-top").height(),pos=$("#catalog").offset(),$(window).scrollTop()+height>pos.top&&$(window).scrollTop(pos.top-height),stepCatalog++,slideCatalog(stepCatalog)}),$("#tab_menu button").click(function(e){e.preventDefault(),$(this).hasClass("active")||($("#tab_menu .active").toggleClass("active"),$(this).toggleClass("active"),$(".tab-content .active").toggleClass("active").toggleClass("hidden-xs").toggleClass("hidden-sm"),$($(this).attr("data-id")).toggleClass("active").toggleClass("hidden-xs").toggleClass("hidden-sm"),Width1(),Width2())}),alphabet.call($("#letter")),console.time("c"),ICD.classes=getJsonFile("classes"),console.timeEnd("c"),console.time("b"),ICD.blocks=getJsonFile("blocks"),console.timeEnd("b"),console.time("n"),ICD.nosologies=getJsonFile("nosologies"),console.timeEnd("n"),console.time("d"),ICD.diseases=getJsonFile("diseases"),console.timeEnd("d"),formCatalog.call($("#catalog1"),ICD.classes,"class",0),Width1(),Width2(),window.onload=function(){console.log("lang"),console.time("dom"),re=/(?:^|\W)#(\w+)(?!\w)/g,console.timeEnd("dom");var e=0;$("#autocomplete").autocomplete({autoFocus:!0,source:ICD.diseases,minLength:3,focus:function(e,t){console.log("focus"),e.toElement||(pos=$(".ui-state-focus").offset(),$(window).scrollTop(pos.top-$(window).height()/2))},select:function(e,t){return item=ICD.nosologies[t.item.value],$("#result").text(t.item.l+"."+t.item.n1+"."+t.item.n2+" "+t.item.label),$("#autocomplete-id").val(t.item.l2),$("#autocomplete-description").html(t.item.n1),!1},search:function(){console.time("FastSearching")},response:function(){console.timeEnd("FastSearching"),console.time("FastDrawing")},open:function(){console.timeEnd("FastDrawing")},create:function(){$(this).data("ui-autocomplete")._renderItem=function(t,n){e++;var l;switch(e){case 0:l="success";break;case 1:l="info";break;case 2:l="warning";break;case 3:l="danger"}return l="list-group-item-"+l,3==e&&(e=0),$("<li>").append(n.label).addClass("list-group-item").addClass(l).appendTo(t)},$(this).data("ui-autocomplete")._resizeMenu=function(e,t){this.menu.element.width(width2-2)}}})};